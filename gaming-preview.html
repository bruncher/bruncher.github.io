<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gaming Deals Preview</title>
<link rel="stylesheet" href="style.css" />
<link rel="icon" href="data:,">

<!-- React via ESM -->
<script type="module" crossorigin>
import React from "https://esm.sh/react@18.3.1";
import { createRoot } from "https://esm.sh/react-dom@18.3.1/client";

function GamingTable() {
  const [data, setData] = React.useState([]);
  const [loading, setLoading] = React.useState(true);

  React.useEffect(() => {
    async function load() {
      try {
        console.log("Fetching deals...");
        const res = await fetch("https://gaming-api-4ic4.onrender.com/deals");
        console.log("Response status:", res.status);
        const json = await res.json();
        console.log("API response:", json);
        setData(json.deals || []);
      } catch (e) {
        console.error("Error fetching deals:", e);
        setData([]);
      } finally {
        setLoading(false);
      }
    }
    load();
  }, []);

  if (loading) return <p style={{ textAlign: "center" }}>Loading…</p>;
  if (!data.length) return <p style={{ textAlign: "center" }}>No deals found.</p>;

  return (
    <div style={{ overflowX: "auto", marginTop: "1rem" }}>
      <table style={{ width: "100%", borderCollapse: "collapse" }}>
        <thead>
          <tr>
            <th>Thumb</th>
            <th>Title</th>
            <th>Store</th>
            <th>Price</th>
          </tr>
        </thead>
        <tbody>
          {data.map(item => (
            <tr key={item.dealID}>
              <td><img src={item.thumb} alt={item.title} style={{ height: "50px" }} /></td>
              <td>{item.title}</td>
              <td>{item.storeName}</td>
              <td>${item.salePrice}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

window.addEventListener("DOMContentLoaded", () => {
  const root = createRoot(document.getElementById("app"));
  root.render(<GamingTable />);
});
</script>
</head>
<body>
<main style="max-width: 1100px; padding: 2rem 1rem; margin: 0 auto;">
  <h1 style="text-align:center; margin-bottom: 1rem;">Gaming Deals Preview</h1>
  <p style="text-align:center; color:#555;">This page is not linked publicly — safe to experiment.</p>

  <!-- Wrap table in dashboard-section for consistent styling -->
  <div class="dashboard-section">
    <h2 style="text-align:center; margin-bottom:1rem;">Gaming Deals</h2>
    <div id="app"></div>
  </div>
</main>
</body>
</html>
