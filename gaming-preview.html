<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gaming Deals Preview</title>
<link rel="stylesheet" href="style.css" />
<link rel="icon" href="data:,">

<script type="module" crossorigin>
import React from "https://esm.sh/react@18.3.1";
import { createRoot } from "https://esm.sh/react-dom@18.3.1/client";

function GamingTable() {
  const [data, setData] = React.useState([]);
  const [loading, setLoading] = React.useState(true);

  // Pagination state
  const [pageSize, setPageSize] = React.useState(25);
  const [page, setPage] = React.useState(1);

  React.useEffect(() => {
    async function load() {
      try {
        const res = await fetch("https://gaming-api-4ic4.onrender.com/deals");
        const json = await res.json();
        setData(json.deals || []);
      } catch (e) {
        console.error("Error fetching deals:", e);
        setData([]);
      } finally {
        setLoading(false);
      }
    }
    load();
  }, []);

  // Derived pagination values
  const totalPages = Math.ceil(data.length / pageSize);
  const start = (page - 1) * pageSize;
  const visible = data.slice(start, start + pageSize);

  // Reset to page 1 when page size changes
  React.useEffect(() => {
    setPage(1);
  }, [pageSize]);

  if (loading)
    return React.createElement("p", { style: { textAlign: "center" } }, "Loading…");

  if (!data.length)
    return React.createElement("p", { style: { textAlign: "center" } }, "No deals found.");

  return React.createElement(
    "div",
    null,

    // PAGE SIZE SELECTOR
    React.createElement(
      "div",
      { style: { marginBottom: "1rem", display: "flex", justifyContent: "flex-end", gap: "0.5rem" } },
      React.createElement("span", null, "Rows per page:"),
      React.createElement(
        "select",
        {
          value: pageSize,
          onChange: (e) => setPageSize(Number(e.target.value)),
        },
        [10, 25, 50, 100].map((n) =>
          React.createElement("option", { key: n, value: n }, n)
        )
      )
    ),

    // TABLE
    React.createElement(
      "div",
      { style: { overflowX: "auto", marginTop: "1rem" } },
      React.createElement(
        "table",
        { style: { width: "100%", borderCollapse: "collapse" } },
        React.createElement(
          "thead",
          null,
          React.createElement(
            "tr",
            null,
            ["Thumb", "Title", "Store", "Price"].map((th) =>
              React.createElement("th", { key: th }, th)
            )
          )
        ),
        React.createElement(
          "tbody",
          null,
          visible.map((item) =>
            React.createElement(
              "tr",
              { key: item.dealID },
              React.createElement(
                "td",
                null,
                React.createElement("img", {
                  src: item.thumb,
                  alt: item.title,
                  style: { height: "50px" },
                })
              ),
              React.createElement("td", null, item.title),
              React.createElement("td", null, item.storeName),
              React.createElement("td", null, `$${item.salePrice}`)
            )
          )
        )
      )
    ),

    // PAGINATION CONTROLS
    React.createElement(
      "div",
      {
        style: {
          marginTop: "1rem",
          display: "flex",
          justifyContent: "center",
          gap: "1rem",
        },
      },
      React.createElement(
        "button",
        {
          disabled: page === 1,
          onClick: () => setPage((p) => Math.max(1, p - 1)),
        },
        "Prev"
      ),
      React.createElement(
        "span",
        null,
        `Page ${page} of ${totalPages}`
      ),
      React.createElement(
        "button",
        {
          disabled: page === totalPages,
          onClick: () => setPage((p) => Math.min(totalPages, p + 1)),
        },
        "Next"
      )
    )
  );
}

window.addEventListener("DOMContentLoaded", () => {
  const root = createRoot(document.getElementById("app"));
  root.render(React.createElement(GamingTable));
});
</script>
</head>
<body>
<main style="max-width: 1100px; padding: 2rem 1rem; margin: 0 auto;">
  <h1 style="text-align:center; margin-bottom: 1rem;">Gaming Deals Preview</h1>
  <p style="text-align:center; color:#555;">This page is not linked publicly — safe to experiment.</p>

  <div class="dashboard-section">
    <h2 style="text-align:center; margin-bottom:1rem;">Gaming Deals</h2>
    <div id="app"></div>
  </div>
</main>
</body>
</html>
